<script type="text/javascript">
    function searchClick() {
        $('#warehouseTree').combotree({
            url: '/Area/GetDetailsTree/',
            multiple: true,
            width: 160
        });
        SearchLoad();
        $('#dlg-search').dialog('open').dialog('setTitle', '当前库存查询');
        $('#product').combogrid('clear');
    };
    function SearchLoad() {
        $('#product').combogrid({
            disabled: false,
            width: 160,
            panelWidth: 340,
            url: '/Product/Details/?page=1&rows=10',
            idField: 'ProductCode',
            textField: 'ProductName',
            mode: 'local',
            editable: false,
            fitColumns: true,
            columns: [[
					{ field: 'ProductCode', title: '卷烟编码', align: 'left', width: 40 },
					{ field: 'ProductName', title: '卷烟名称', align: 'left', width: 40 },
					{ field: 'IsActive', title: '是否可用', align: 'left', width: 30 }
				]]
        });
    }
    function select() {
        ware = "", area = "";
        var roots = $('#warehouseTree').combotree('tree').tree('getRoots');
        //仓库
        for (i = 0; i < roots.length; i++) {
            if (roots[i].attributes == "ware" && roots[i].checked == true) {
                ware += roots[i].id + ",";
            }
            else {
                areaChildren = $('#warehouseTree').tree('getChildren', roots[i].target);
                //库区
                for (j = 0; j < areaChildren.length; j++) {
                    if (areaChildren[j].attributes == "area" && areaChildren[j].checked == true) {
                        area += areaChildren[j].id + ",";
                    }
                }
            }
        }
        var queryParams = $('#details').datagrid('options').queryParams;
        queryParams.ProductCode = $('#product').combo('getValue');
        queryParams.Ware = ware;
        queryParams.Area = area;
        $('#details').datagrid('options').queryParams = queryParams;
        $('#details').datagrid({
            pageNumber: 1,
            pageSize: 10
        });
        $("#details").datagrid('reload');
        $('#dlg-search').dialog('close');
    }
</script>
<div id="dlg-search" class="easyui-dialog" modal="true" style="width:280px;height:160px;padding:2px 2px"
    closed="true" buttons="#dlg-buttons-search">
    <div class="easyui-layout" fit="true">
        <div region="center" border="false" style="padding:10px 10px;background:#fff;border:1px solid #ccc; " overflow: scroll; padding: 1px; margin: 1px">
            <table>
                <tr>
                    <td>产品名称:</td>
                    <td align="left"><input type="text" id="product"/></td>
                </tr>
                <tr>
                    <td>库区选择:</td>
                    <td align="left">
                        <select class="easyui-combotree" name="language" url=""valueField="id" textField="text" multiple="true" panelHeight="auto" panelWidth="160px" id="warehouseTree">
                        </select>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>
<div id="dlg-buttons-search">
	<a href="#" class="easyui-linkbutton" iconCls="icon-ok" onclick="select()">查询</a>
	<a href="#" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg-search').dialog('close')">取消</a>
</div>