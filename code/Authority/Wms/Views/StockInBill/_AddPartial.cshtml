<script type="text/javascript">
    var url;
    $(function () {
        $('#cc').combo({
            required: true,
            editable: false,
            panelHeight: 45,
            panelWidth: 100
        });
    })

    function DataLoad() {
        $('#wareHouse-add').combogrid({
            width: 130,
            panelWidth: 340,
            url: '/WareHouse/Details/?page=1&rows=10',
            idField: 'WarehouseCode',
            textField: 'WarehouseName',
            mode: 'local',
            editable: false,
            fitColumns: true,
            columns: [[
                    { field: 'WarehouseCode', title: '仓库编码', align: 'left', width: 40 },
                    { field: 'WarehouseName', title: '仓库名称', align: 'left', width: 30 },
                    { field: 'IsActive', title: '是否可用', align: 'left', width: 30 }
                ]]
        });

        $('#billType-add').combogrid({
            width: 130,
            panelWidth: 340,
            url: '/StockInBillType/Details/?page=1&rows=10',
            idField: 'BillTypeCode',
            textField: 'BillTypeName',
            mode: 'local',
            editable: false,
            fitColumns: true,
            columns: [[
                    { field: 'BillTypeCode', title: '仓库编码', align: 'left', width: 40 },
                    { field: 'BillTypeName', title: '仓库名称', align: 'left', width: 30 },
                    { field: 'IsActive', title: '是否可用', align: 'left', width: 30 }
                ]]
        });
    }

    function getTime(){
        var d = new Date();
        var vYear = d.getFullYear();
        var vMon = d.getMonth() + 1;
        var vDay = d.getDate();
        var h = d.getHours();
        var m = d.getMinutes();
        t=vYear+"-"+(vMon<10 ? "0" + vMon : vMon)+"-"+(vDay<10 ? "0"+ vDay : vDay)+" "+(h<10 ? "0"+ h : h)+":"+(m<10 ? "0" + m : m);
        return t;
    }

    function addClick() {
        $('#billNo').attr("readonly", true);
        $('#billDate').attr("readonly", true);
        DataLoad();
        $('#billNo').val();
        $('#billDate').val(getTime());
        $.getJSON("/StockInBill/GenInBillNo/", function (json) {
            if (json) {
                $('#billNo').val(json);
            } else {
                $.messager.show({ title: '系统提示', msg: '失败!请检查原因！' });
            }
        });
        $('#dlg').dialog('open').dialog('setTitle', '新增入库订单');
        $('#fm').form('clear');
        $('#fm .easyui-validatebox').validatebox({
            required: true
        });
        $('form input').removeAttr("disabled");
        $('form textarea').removeAttr("disabled");
        $('#cc').combo({
            hasDownArrow: true
        });
        url = '';
    };

    function save() {
        $('#fm').form('submit', {
            url: url,
            onSubmit: function () {
                return $(this).form('validate');
            },
            success: function (result) {
                var result = eval('(' + result + ')');
                if (result.success) {
                    $.messager.show({
                        title: '成功',
                        msg: result.msg
                    });
                    $('#dlg').dialog('close');
                    $('#details').datagrid('reload');
                } else {
                    $.messager.show({
                        title: '错误',
                        msg: result.msg
                    });
                    $('#details').datagrid('reload');
                }
            }
        });
    }
</script>
    <div id="dlg" class="easyui-dialog" modal="true" 
        style="width:700px;height:453px;padding:0px 0px"
        closed="true" buttons="#dlg-buttons">
<div region="center" split="true"  border="false" style="border-bottom-style: solid; border-bottom-width: 1px; border-bottom-color: #99BBE8" fit="true">    
<table style=" padding:2px 2px 0px 5px" >
  <tr>
    <td align="right" valign="middle">入库单号</td>
    <td align="left">
      <input type="text" name="BillNo" id="billNo"/>
    </td>
    <td align="right" valign="middle">制单日期</td>
    <td align="left"><input type="text" name="BillDate" id="billDate"/></td>
    <td align="right" valign="middle">单据类型</td>
    <td align="left"><input type="text" name="BillTypeCode" id="billType-add"/></td>
    <td align="left">
  </td>
  </tr>
  <tr>
    <td style=" text-align:right">操作员</td>
    <td align="left"><input type="text" name="OperatePersonCode"/></td>
    <td style=" text-align:right">审核人</td>
    <td align="left"><input type="text" name="VerifyPersonCode"/></td>
    <td style=" text-align:right">入库仓库</td>
    <td align="left"><input type="text" name="WarehouseCode" id="wareHouse-add"/></td>
    <td align="left"></td>
  </tr>
  <tr>
    <td style=" text-align:right">处理状态</td>
    <td align="left"><input type="text" name="bill、3"/></td>
    <td style=" text-align:right">审核日期</td>
    <td align="left"><input type="text" name="bill、6"/></td>
    <td style=" text-align:right">总金额</td>
    <td align="left"><input type="text" name="bill、9"/></td>
    <td align="left"></td>
  </tr>
  <tr>
    <td style=" text-align:right">备注</td>
    <td align="left"><textarea name="textarea" id="textarea" cols="20" rows="2"></textarea></td>
    <td style=" text-align:right">总数量</td>
    <td align="left"><input type="text" name="bill、10"/></td>
    <td style=" text-align:right">是否可用</td>
    <td><select id="cc" name="Status" class="easyui-combobox" style="width: 60px">
		    <option value="true">可用</option>
		    <option value="false">不可用</option>
	    </select>
    </td>
    <td align="left"></td>
  </tr>
</table>
</div>
<div region="south" split="true" border="false" style="height: 280px;">
    <table class="easyui-datagrid" border="false" id="details" toolbar="#dlg-detailButtons"
        fit="true" fitColumns="true"  pagination="true" rownumbers="true" >
        <thead>
            <tr>
                <th field="ProductCode" width="100">产品代码</th>
                <th field="ProductName" width="80" align="right">产品名称</th>
                <th field="UnitCode" width="80" align="right">单位编码</th>
                <th field="UnitName" width="80" align="right">单位名称</th>
                <th field="BillQuantity" width="80" align="right">数量</th>
                <th field="RealQuantity" width="80" align="right">实际入库量</th>
                <th field="Price" width="80" align="right">单价</th>
                <th field="Description" width="80" align="right">备注</th>
            </tr>
        </thead>
    </table>
</div>
</div>
<div id="dlg-buttons">
	<a href="#" class="easyui-linkbutton" iconCls="icon-ok" onclick="save()">确定</a>
	<a href="#" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')">取消</a>
</div>
<div id="dlg-detailButtons">
	<a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="save()">添加明细</a>
	<a href="#" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="javascript:$('#dlg').dialog('close')">删除明细</a>
    <a href="#" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="javascript:$('#dlg').dialog('close')">修改明细</a>
</div>
